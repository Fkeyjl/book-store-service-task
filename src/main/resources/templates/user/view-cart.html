<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{nav.cart} + ' - ' + #{app.name}">Кошик - Книжковий магазин</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/cart.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
<div th:replace="~{layouts/header.html::header}"></div>

<div class="cart-container">
    <h2><i class="fas fa-shopping-cart"></i> <span th:text="#{cart.title}">Ваш кошик</span></h2>

    <div th:if="${errorMessage}" class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
        <i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}">Помилка</span>
    </div>

    <div th:if="${cart == null || cart.items.isEmpty()}" class="empty-cart-message">
        <i class="fas fa-shopping-basket" style="font-size: 4rem; color: #bbb; margin-bottom: 20px;"></i>
        <p th:text="#{message.emptyCart}">Ваш кошик порожній</p>
        <a th:href="@{/books}" class="continue-shopping">
            <i class="fas fa-book"></i> <span th:text="#{common.continueShopping}">Продовжити покупки</span>
        </a>
    </div>

    <div th:unless="${cart == null || cart.items.isEmpty()}">
        <table class="cart-table">
            <thead>
            <tr>
                <th th:text="#{cart.book}">Книга</th>
                <th th:text="#{cart.quantity}">Кількість</th>
                <th th:text="#{cart.pricePerUnit}">Ціна за одиницю</th>
                <th th:text="#{cart.total}">Всього</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${cartDetails}">
                <td>
                    <i class="fas fa-book" style="margin-right: 8px; color: #7f8c8d;"></i>
                    <span th:text="${item.book.name}">Назва книги</span>
                </td>
                <td>
                    <form th:action="@{/cart/update/{bookId}(bookId=${item.book.id})}" method="post" style="display: inline-flex; align-items: center; gap: 5px;">
                        <label>
                            <input type="number" name="quantity" th:value="${item.quantity}" min="1" max="100"
                                   style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        </label>
                        <button type="submit" style="padding: 5px 10px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </form>
                </td>
                <td><span th:text="${item.book.price}">150.00</span> <span th:text="#{common.currency}">грн</span></td>
                <td><strong><span th:text="${item.totalPrice}">300.00</span> <span th:text="#{common.currency}">грн</span></strong></td>
                <td>
                    <form th:action="@{/cart/remove/{bookId}(bookId=${item.book.id})}" method="post" style="margin: 0;">
                        <button type="submit" class="remove-button" th:title="#{cart.remove}">
                            <i class="fas fa-times"></i>
                        </button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="cart-summary">
            <h3><i class="fas fa-calculator"></i> <span th:text="#{cart.summary}">Підсумок</span></h3>
            <p>
                <span th:text="#{cart.quantity} + ':'">Кількість позицій:</span>
                <span th:text="${cart.totalQuantity}">0</span>
            </p>
            <p>
                <span th:text="#{cart.total} + ':'">Загальна сума:</span>
                <span class="total-price" th:text="${cart.totalPrice}">0.00</span>
            </p>

            <form th:action="@{/cart/checkout}" method="post">
                <button type="submit" class="checkout-button">
                    <i class="fas fa-check-circle"></i> <span th:text="#{cart.checkout}">Оформити замовлення</span>
                </button>
            </form>
        </div>
    </div>
</div>
</body>
</html>